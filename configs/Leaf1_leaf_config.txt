
hostname Leaf1
vdc Leaf1 id 1
  limit-resource vlan minimum 16 maximum 4094
  limit-resource vrf minimum 2 maximum 4096
  limit-resource port-channel minimum 0 maximum 511
  limit-resource u4route-mem minimum 128 maximum 128
  limit-resource u6route-mem minimum 96 maximum 96
  limit-resource m4route-mem minimum 58 maximum 58
  limit-resource m6route-mem minimum 8 maximum 8


 

no password strength-check
username admin password 5 $5$7OEzCM88$fRMTz8Lh/V2dUTjD9NdxPltDebBjny4EP7.WGYSg2v2  role network-admin
username cisco password 5 $5$uiQ362.e$22MssNQzgRoXdf0s7BPXPmw/5eLQAOc1VZxjDXF0XI/  role network-admin
username cisco passphrase  lifetime 99999 warntime 14 gracetime 3
ip domain-lookup
copp profile strict
snmp-server user admin network-admin auth md5 0xff2a1fca1ded634bf79b2a046c3fc337 priv 0xff2a1fca1ded634bf79b2a046c3fc337 localizedkey
snmp-server user cisco network-admin auth md5 0xff2a1fca1ded634bf79b2a046c3fc337 priv 0xff2a1fca1ded634bf79b2a046c3fc337 localizedkey
rmon event 1 description FATAL(1) owner PMON@FATAL
rmon event 2 description CRITICAL(2) owner PMON@CRITICAL
rmon event 3 description ERROR(3) owner PMON@ERROR
rmon event 4 description WARNING(4) owner PMON@WARNING
rmon event 5 description INFORMATION(5) owner PMON@INFO

fabric forwarding anycast-gateway-mac 1134.dead.beef

vlan 100
  name Customer_A
  vn-segment 200100
vlan 200
  name Customer_B
  vn-segment 200200
vlan 3100
  name Customer_A_VXLAN_Routing_VLAN
  vn-segment 500100
vlan 3200
  name Customer_B_VXLAN_Routing_VLAN
  vn-segment 500200

route-map RM_BLUE_ROUTES permit 10
  match tag 500100
route-map RM_WHITE_ROUTES permit 10
  match tag 500200
vrf context BLUE
  description BLUE_VRF
  vni 500100
  rd auto
  address-family ipv4 unicast
    route-target both auto evpn
vrf context WHITE
  description WHITE_VRF
  vni 500200
  rd auto
  address-family ipv4 unicast
    route-target both auto evpn

hardware access-list tcam region racl 256
hardware access-list tcam region arp-ether 256 double-wide


interface Vlan1

interface Vlan100
  description Customer_A_SVI
  no shutdown
  vrf member BLUE
  no ip redirects 
  ip address 10.100.1.1/24
  no ipv6 redirects
  fabric forwarding mode anycast-gateway

interface Vlan200
  description Customer_B_SVI
  no shutdown
  vrf member WHITE
  no ip redirects 
  ip address 10.200.1.1/24
  no ipv6 redirects
  fabric forwarding mode anycast-gateway

interface Vlan3100
  description BLUE_VXLAN_SVI
  no shutdown
  vrf member BLUE
  ip forward

interface Vlan3200
  description WHITE_VXLAN_SVI
  no shutdown
  vrf member WHITE
  ip forward

interface nve1
  no shutdown
  description VTEP
  host-reachability protocol bgp
  source-interface loopback2
  global suppress-arp
  global ingress-replication protocol bgp
  member vni 200100
  member vni 200200
  member vni 300100 associate-vrf
  member vni 300200 associate-vrf

interface Ethernet1/1
  description LINK_TO_SPINE1
  no switchport
  mtu 9216
  medium p2p
  ip unnumbered loopback0
  ip ospf network point-to-point
  ip router ospf UNDERLAY area 0.0.0.0
  no shutdown
interface Ethernet1/2
  description LINK_TO_SPINE2
  no switchport
  mtu 9216
  medium p2p
  ip unnumbered loopback0
  ip ospf network point-to-point
  ip router ospf UNDERLAY area 0.0.0.0
  no shutdown
interface Ethernet1/3
  description TO_R1
  switchport mode trunk
  switchport trunk allowed vlan 100,200
  spanning-tree port type edge trunk
  spanning-tree bpduguard enable
interface loopback0
  description UNDERLAY_LOOPBACK
  ip address 172.63.63.3/32
  ip router ospf UNDERLAY area 0.0.0.0

interface loopback2
  description OVERLAY_LOOPBACK
  ip address 172.93.93.3/32
  ip router ospf UNDERLAY area 0.0.0.0
line console
  exec-timeout 0
  terminal width  511
line vty
boot nxos bootflash:/nxos.9.2.3.bin 
router ospf UNDERLAY
  router-id 172.63.63.3
  log-adjacency-changes
router bgp 65510
  router-id 172.93.93.3
  log-neighbor-changes
  template peer SPINE_PEERS_TEMPLATE
    remote-as 65510
    log-neighbor-changes
    update-source loopback2
    address-family ipv4 unicast
    address-family l2vpn evpn
      inherit peer-policy SPINE_PEER_POLICY_TEMPLATE 1
      send-community extended
  template peer-policy SPINE_PEER_POLICY_TEMPLATE
    soft-reconfiguration inbound always
  neighbor 172.93.93.1
    inherit peer SPINE_PEERS_TEMPLATE
  neighbor 172.93.93.2
    inherit peer SPINE_PEERS_TEMPLATE
  vrf BLUE
    address-family ipv4 unicast
      redistribute direct route-map RM_BLUE_ROUTES
  vrf WHITE
    address-family ipv4 unicast
      redistribute direct route-map RM_WHITE_ROUTES
evpn
  vni 200100 l2
    rd auto
    route-target import auto
    route-target export auto
  vni 200200 l2
    rd auto
    route-target import auto
    route-target export auto

no logging console